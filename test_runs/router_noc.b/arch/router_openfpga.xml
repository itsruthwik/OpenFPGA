<?xml version="1.0"?>
<!-- Architecture annotation for OpenFPGA framework
     This annotation supports the k6_N10_40nm.xml 
     - General purpose logic block
       - K = 6, N = 10, I = 40
       - Single mode
     - Routing architecture
       - L = 4, fc_in = 0.15, fc_out = 0.1
  -->
<openfpga_architecture>
  <technology_library>
    <device_library>
      <device_model name="logic" type="transistor">
        <lib type="industry" corner="TOP_TT" ref="M" path="${OPENFPGA_PATH}/openfpga_flow/tech/PTM_45nm/45nm.pm"/>
        <design vdd="0.9" pn_ratio="2"/>
        <pmos name="pch" chan_length="40e-9" min_width="140e-9" variation="logic_transistor_var"/>
        <nmos name="nch" chan_length="40e-9" min_width="140e-9" variation="logic_transistor_var"/>
      </device_model>
      <device_model name="io" type="transistor">
        <lib type="academia" ref="M" path="${OPENFPGA_PATH}/openfpga_flow/tech/PTM_45nm/45nm.pm"/>
        <design vdd="2.5" pn_ratio="3"/>
        <pmos name="pch_25" chan_length="270e-9" min_width="320e-9" variation="io_transistor_var"/>
        <nmos name="nch_25" chan_length="270e-9" min_width="320e-9" variation="io_transistor_var"/>
      </device_model>
    </device_library>
    <variation_library>
      <variation name="logic_transistor_var" abs_deviation="0.1" num_sigma="3"/>
      <variation name="io_transistor_var" abs_deviation="0.1" num_sigma="3"/>
    </variation_library>
  </technology_library>
  <circuit_library>
    <circuit_model type="inv_buf" name="INVTX1" prefix="INVTX1" is_default="true">
      <design_technology type="cmos" topology="inverter" size="1"/>
      <device_technology device_model_name="logic"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <delay_matrix type="rise" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
      <delay_matrix type="fall" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
    </circuit_model>
    <circuit_model type="inv_buf" name="buf4" prefix="buf4" is_default="false">
      <design_technology type="cmos" topology="buffer" size="1" num_level="2" f_per_stage="4"/>
      <device_technology device_model_name="logic"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <delay_matrix type="rise" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
      <delay_matrix type="fall" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
    </circuit_model>
    <circuit_model type="inv_buf" name="tap_buf4" prefix="tap_buf4" is_default="false">
      <design_technology type="cmos" topology="buffer" size="1" num_level="3" f_per_stage="4"/>
      <device_technology device_model_name="logic"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <delay_matrix type="rise" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
      <delay_matrix type="fall" in_port="in" out_port="out">
        10e-12
      </delay_matrix>
    </circuit_model>
    <circuit_model type="pass_gate" name="TGATE" prefix="TGATE" is_default="true">
      <design_technology type="cmos" topology="transmission_gate" nmos_size="1" pmos_size="2"/>
      <device_technology device_model_name="logic"/>
      <input_buffer exist="false"/>
      <output_buffer exist="false"/>
      <port type="input" prefix="in" size="1"/>
      <port type="input" prefix="sel" size="1"/>
      <port type="input" prefix="selb" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <delay_matrix type="rise" in_port="in sel selb" out_port="out">
        10e-12 5e-12 5e-12
      </delay_matrix>
      <delay_matrix type="fall" in_port="in sel selb" out_port="out">
        10e-12 5e-12 5e-12
      </delay_matrix>
    </circuit_model>
    <circuit_model type="chan_wire" name="chan_segment" prefix="track_seg" is_default="true">
      <design_technology type="cmos"/>
      <input_buffer exist="false"/>
      <output_buffer exist="false"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <wire_param model_type="pi" R="101" C="22.5e-15" num_level="1"/>
      <!-- model_type could be T, res_val and cap_val DON'T CARE -->
    </circuit_model>
    <circuit_model type="wire" name="direct_interc" prefix="direct_interc" is_default="true">
      <design_technology type="cmos"/>
      <input_buffer exist="false"/>
      <output_buffer exist="false"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <wire_param model_type="pi" R="0" C="0" num_level="1"/>
      <!-- model_type could be T, res_val cap_val should be defined -->
    </circuit_model>
    <circuit_model type="mux" name="mux_tree" prefix="mux_tree" dump_structural_verilog="true">
      <design_technology type="cmos" structure="tree" add_const_input="true" const_input_val="1"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <pass_gate_logic circuit_model_name="TGATE"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <port type="sram" prefix="sram" size="1"/>
    </circuit_model>
    <circuit_model type="mux" name="mux_tree_tapbuf" prefix="mux_tree_tapbuf" is_default="true" dump_structural_verilog="true">
      <design_technology type="cmos" structure="tree" add_const_input="true" const_input_val="1"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="tap_buf4"/>
      <pass_gate_logic circuit_model_name="TGATE"/>
      <port type="input" prefix="in" size="1"/>
      <port type="output" prefix="out" size="1"/>
      <port type="sram" prefix="sram" size="1"/>
    </circuit_model>
    <!--DFF subckt ports should be defined as <D> <Q> <CLK> <RESET> <SET>  -->
    <circuit_model type="ff" name="DFFSRQ" prefix="DFFSRQ" spice_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/spice/dff.sp" verilog_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/verilog/dff.v">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <port type="input" prefix="D" size="1"/>
      <port type="input" prefix="set" lib_name="SET" size="1" is_global="true" default_val="0" is_set="true"/>
      <port type="input" prefix="reset" lib_name="RST" size="1" is_global="true" default_val="0" is_reset="true"/>
      <port type="output" prefix="Q" size="1"/>
      <port type="clock" prefix="clk" lib_name="CK" size="1" is_global="true" default_val="0"/>
    </circuit_model>
    <circuit_model type="lut" name="lut4" prefix="lut4" dump_structural_verilog="true">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <lut_input_inverter exist="true" circuit_model_name="INVTX1"/>
      <lut_input_buffer exist="true" circuit_model_name="buf4"/>
      <pass_gate_logic circuit_model_name="TGATE"/>
      <port type="input" prefix="in" size="4"/>
      <port type="output" prefix="out" size="1"/>
      <port type="sram" prefix="sram" size="16"/>
    </circuit_model>
    <!--Scan-chain DFF subckt ports should be defined as <D> <Q> <Qb> <CLK> <RESET> <SET>  -->
    <circuit_model type="ccff" name="DFF" prefix="DFF" spice_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/spice/dff.sp" verilog_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/verilog/dff.v">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <port type="input" prefix="D" size="1"/>
      <port type="output" prefix="Q" size="1"/>
      <port type="output" prefix="QN" size="1"/>
      <port type="clock" prefix="prog_clk" lib_name="CK" size="1" is_global="true" default_val="0" is_prog="true"/>
    </circuit_model>
    <circuit_model type="iopad" name="GPIO" prefix="GPIO" spice_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/spice/gpio.sp" verilog_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/verilog/gpio.v">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <port type="inout" prefix="PAD" size="1" is_global="true" is_io="true" is_data_io="true"/>
      <port type="sram" prefix="DIR" size="1" mode_select="true" circuit_model_name="DFF" default_val="1"/>
      <port type="input" prefix="outpad" lib_name="A" size="1"/>
      <port type="output" prefix="inpad" lib_name="Y" size="1"/>
    </circuit_model>
    <!-- <circuit_model type="hard_logic" name="mult_8x8" prefix="mult_8x8" is_default="true" spice_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/spice/mult_8x8.sp" verilog_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/verilog/mult_8x8.v">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>
      <port type="input" prefix="A" lib_name="A" size="8"/>
      <port type="input" prefix="B" lib_name="B" size="8"/>
      <port type="output" prefix="Y" lib_name="Y" size="16"/>
    </circuit_model> -->
    <circuit_model type="hard_logic" name="router_wrap" prefix="router_wrap" is_default="true" spice_netlist="${OPENFPGA_PATH}/openfpga_flow/openfpga_cell_library/spice/router_wrap.sp" verilog_netlist="/home/rsunketa/OpenFPGA/test_runs/nocgen/src/router.v">
      <design_technology type="cmos"/>
      <input_buffer exist="true" circuit_model_name="INVTX1"/>
      <output_buffer exist="true" circuit_model_name="INVTX1"/>

      <!-- <port type="input" prefix="clk" lib_name="clk" size="1"/>   -->
      <port type="input" prefix="rst_" lib_name="rst_" size="1"/>  
      <port type="input" prefix="my_xpos" lib_name="my_xpos" size="2"/>  
      <port type="input" prefix="my_ypos" lib_name="my_ypos" size="2"/>  
      <port type="input" prefix="idata_0" lib_name="idata_0" size="35"/>   
      <port type="input" prefix="idata_1" lib_name="idata_1" size="35"/>   
      <port type="input" prefix="idata_2" lib_name="idata_2" size="35"/>   
      <port type="input" prefix="idata_3" lib_name="idata_3" size="35"/>   
      <port type="input" prefix="idata_4" lib_name="idata_4" size="35"/>   
      <port type="input" prefix="ivalid_0" lib_name="ivalid_0" size="1"/>  
      <port type="input" prefix="ivalid_1" lib_name="ivalid_1" size="1"/>  
      <port type="input" prefix="ivalid_2" lib_name="ivalid_2" size="1"/>  
      <port type="input" prefix="ivalid_3" lib_name="ivalid_3" size="1"/>  
      <port type="input" prefix="ivalid_4" lib_name="ivalid_4" size="1"/>  
      <port type="input" prefix="ivch_0" lib_name="ivch_0" size="1"/>   
      <port type="input" prefix="ivch_1" lib_name="ivch_1" size="1"/>    
      <port type="input" prefix="ivch_2" lib_name="ivch_2" size="1"/>    
      <port type="input" prefix="ivch_3" lib_name="ivch_3" size="1"/>    
      <port type="input" prefix="ivch_4" lib_name="ivch_4" size="1"/>    
      <port type="input" prefix="iack_0" lib_name="iack_0" size="2"/>    
      <port type="input" prefix="iack_1" lib_name="iack_1" size="2"/>    
      <port type="input" prefix="iack_2" lib_name="iack_2" size="2"/>    
      <port type="input" prefix="iack_3" lib_name="iack_3" size="2"/>    
      <port type="input" prefix="iack_4" lib_name="iack_4" size="2"/>    
      <port type="input" prefix="ilck_0" lib_name="ilck_0" size="2"/>    
      <port type="input" prefix="ilck_1" lib_name="ilck_1" size="2"/>    
      <port type="input" prefix="ilck_2" lib_name="ilck_2" size="2"/>    
      <port type="input" prefix="ilck_3" lib_name="ilck_3" size="2"/>    
      <port type="input" prefix="ilck_4" lib_name="ilck_4" size="2"/>

      <port type="output" prefix="odata_0" lib_name="odata_0" size="35"/>   
      <port type="output" prefix="odata_1" lib_name="odata_1" size="35"/>   
      <port type="output" prefix="odata_2" lib_name="odata_2" size="35"/>   
      <port type="output" prefix="odata_3" lib_name="odata_3" size="35"/>   
      <port type="output" prefix="odata_4" lib_name="odata_4" size="35"/>   
      <port type="output" prefix="ovalid_0" lib_name="ovalid_0" size="1"/>   
      <port type="output" prefix="ovalid_1" lib_name="ovalid_1" size="1"/>   
      <port type="output" prefix="ovalid_2" lib_name="ovalid_2" size="1"/>   
      <port type="output" prefix="ovalid_3" lib_name="ovalid_3" size="1"/>   
      <port type="output" prefix="ovalid_4" lib_name="ovalid_4" size="1"/>   
      <port type="output" prefix="ovch_0" lib_name="ovch_0" size="1"/>   
      <port type="output" prefix="ovch_1" lib_name="ovch_1" size="1"/>   
      <port type="output" prefix="ovch_2" lib_name="ovch_2" size="1"/>   
      <port type="output" prefix="ovch_3" lib_name="ovch_3" size="1"/>   
      <port type="output" prefix="ovch_4" lib_name="ovch_4" size="1"/>   
      <port type="output" prefix="oack_0" lib_name="oack_0" size="2"/>   
      <port type="output" prefix="oack_1" lib_name="oack_1" size="2"/>   
      <port type="output" prefix="oack_2" lib_name="oack_2" size="2"/>   
      <port type="output" prefix="oack_3" lib_name="oack_3" size="2"/>   
      <port type="output" prefix="oack_4" lib_name="oack_4" size="2"/>   
      <port type="output" prefix="ordy_0" lib_name="ordy_0" size="2"/>   
      <port type="output" prefix="ordy_1" lib_name="ordy_1" size="2"/>   
      <port type="output" prefix="ordy_2" lib_name="ordy_2" size="2"/>   
      <port type="output" prefix="ordy_3" lib_name="ordy_3" size="2"/>   
      <port type="output" prefix="ordy_4" lib_name="ordy_4" size="2"/>   
      <port type="output" prefix="olck_0" lib_name="olck_0" size="2"/>   
      <port type="output" prefix="olck_1" lib_name="olck_1" size="2"/>   
      <port type="output" prefix="olck_2" lib_name="olck_2" size="2"/>   
      <port type="output" prefix="olck_3" lib_name="olck_3" size="2"/>   
      <port type="output" prefix="olck_4" lib_name="olck_4" size="2"/>    
        
      <port type="clock" prefix="clk" size="1" is_global="true" default_val="0" is_clock="true"/>
      <!-- <port type="input" prefix="reset" size="1" is_global="true" default_val="0" is_reset="true"/> -->
    </circuit_model>
  </circuit_library>
  <configuration_protocol>
    <organization type="scan_chain" circuit_model_name="DFF"/>
  </configuration_protocol>
  <connection_block>
    <switch name="ipin_cblock" circuit_model_name="mux_tree_tapbuf"/>
  </connection_block>
  <switch_block>
    <switch name="0" circuit_model_name="mux_tree_tapbuf"/>
  </switch_block>
  <!-- <direct_connection>
    <direct name="rtr_ch_0_1" circuit_model_name="direct_interc"/>
    <direct name="rtr_ch_1_0" circuit_model_name="direct_interc"/>
    <direct name="rtr_flow_ctrl__0_1" circuit_model_name="direct_interc"/>
    <direct name="rtr_flow_ctrl__1_0" circuit_model_name="direct_interc"/>
    <direct name="rtr_ch_0_2" circuit_model_name="direct_interc"/>
    <direct name="rtr_ch_2_0" circuit_model_name="direct_interc"/>
    <direct name="rtr_flow_ctrl__0_2" circuit_model_name="direct_interc"/>
    <direct name="rtr_flow_ctrl__2_0" circuit_model_name="direct_interc"/>
  </direct_connection> -->
  <routing_segment>
    <segment name="L4" circuit_model_name="chan_segment"/>
  </routing_segment>

  <!-- <tile_annotations>
    <global_port name="clk" is_clock="true" default_val="0">
      <tile name="clb" port="clk" x="-1" y="-1"/>
    </global_port>
    <global_port name="reset" is_reset="true" default_val="1">
      <tile name="clb" port="reset" x="-1" y="-1"/>
    </global_port>
  </tile_annotations> -->
  <pb_type_annotations>
    <!-- physical pb_type binding in complex block IO -->
    <pb_type name="io" physical_mode_name="physical" idle_mode_name="inpad"/>
    <pb_type name="io[physical].iopad" circuit_model_name="GPIO" mode_bits="1"/>
    <pb_type name="io[inpad].inpad" physical_pb_type_name="io[physical].iopad" mode_bits="1"/>
    <pb_type name="io[outpad].outpad" physical_pb_type_name="io[physical].iopad" mode_bits="0"/>
    <!-- End physical pb_type binding in complex block IO -->
    <!-- physical pb_type binding in complex block CLB -->
    <!-- physical mode will be the default mode if not specified -->
    <pb_type name="clb">
      <!-- Binding interconnect to circuit models as their physical implementation, if not defined, we use the default model -->
      <interconnect name="crossbar" circuit_model_name="mux_tree"/>
    </pb_type>
    <pb_type name="clb.fle[n1_lut4].ble4.lut4" circuit_model_name="lut4"/>
    <pb_type name="clb.fle[n1_lut4].ble4.ff" circuit_model_name="DFFSRQ"/>
    <!-- End physical pb_type binding in complex block IO -->
    <!-- physical pb_type binding in complex block dsp -->
    <!-- <pb_type name="mult_8" physical_mode_name="mult_8x8" idle_mode_name="mult_8x8"/> -->
    <!-- <pb_type name="router" physical_mode_name="router_wrap" idle_mode_name="router_wrap"/> -->
    <pb_type name="router" physical_mode_name="router_wrap" idle_mode_name="router_wrap"/>

    <!-- Bind the primitive pb_type in the physical mode to a circuit model -->
    <!-- <pb_type name="router[router_wrap].router_wrap" circuit_model_name="router_wrap"/> -->
    <!-- <pb_type name="router[physical].router_wrap" circuit_model_name="router_wrap"/> -->
    <pb_type name="router[router_wrap].router_wrap" circuit_model_name="router_wrap"/>


  </pb_type_annotations>
</openfpga_architecture>
